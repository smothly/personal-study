# 라우팅

---

## 6-1 라우팅
- 이더넷과 무선LAN으로 **같은 네트워크** 안에서 데이터를 전송할 수 있음
- **다른 네트워크**에 데이터를 보내려면 네트워크를 서로 연결하는 라우터로 전송해야 함
- **라우팅** = 라우터는 데이터의 목적지가 어느 네트워크에 접속해 있는지 판단해서 연결된 네트워크의 라우터로 전송
- 라우팅을 계속 반복해서 목적지까지 보낼 수 있음
- 라우터가 전송할 대상이 되는 데이터는 **IP 패킷**(TCP/IP 인터넷층에서 동작)
- IP 패킷전송할 때 목적지 IP 주소를 확인하고 IP 헤더의 **TTL**과 **헤더 체크섬**만 변경됨
- 나머지 부분은 변경되지 않은 채로 전송(NAT 변환이 이루어질 때 IP 주소도 변경)
- But, 이데넷 헤더 등 네트워크 인터페이스층의 프로토콜 헤더는 라우터가 전송할 때 완전히 새로운 헤더로 변경됨
- ![프레임과 패킷의 구조](https://t1.daumcdn.net/cfile/tistory/1360E30F4AAF6DB710)

---

## 6-2 네트워크의 연결
- 라우터로 네트워크를 연결할 때도 IP주소를 설정
- 라우터 인터페이스의 물리적 배선에 더해 IP주소를 설정
- 라우터에는 복수의 인터페이스가 준비되어 있어 물리적인 배선과 IP 주소 설정을 각각 할 필요가 있음.
- ![라우터와 연결된 모습](https://lh3.googleusercontent.com/proxy/5LrrT1ciE_SCCyZYdo0ZAEdEmWbZxoStM0y8MNjmklT7L1l-ciIWQTR16MEii7_fRqWLGzDcZzWED3qCNMfppnntXHbXqWU)

---

## 6-3 데이터의 전송처 결정
- 라우터가 데이터를 전송하는 흐름
  - 라우팅 대상인 IP 패킷을 수신함
    - 목적저 MAC주소와 IP주소의 정보를 가진 패킷
  - 경로 정보를 검색해서 전송할 것을 결정
    - 라우팅 테이블에서 경로정보를 검색하여 넥스트 홉(다음에 전송할 라우터)를 알아내서 전송

## 6-4 다음 라우터로 데이터 전송
- 레이어2 헤더를 수정해 IP 패킷을 전송
- 다른 라우터(R1 -> R2)로 전송할 때 이더넷 헤더를 추가해야 함
  - R2의 MAC주소를 구하기 위해 ARP를 실행
    - ARP는 IP주소로 MAC주소를 구하는 프로토콜
    - 라우팅 테이블에서 R2의 IP주소를 아므로 R2의 MAC주소를 구하기위해 ARP를 실행

## 6-5 다음 라우터의 처리
- R2에서도 같은 처리를 함
  - 호스트1이 송신한 패킷과 비교하면 MAC 주소는 바뀌었지만, IP 주소는 같습니다.

## 6-6 최종 목적지 데이터 전송
- 라우팅 테이블에 같은 네트워크에 있는걸 확인
- 최종목적지인 호스트2로 IP 패킷을 전송하려면 호스트2의 MAC 주소가 필요함 - ARP를 사용해서 구함
- 데이터가 도착하면 응답받아 같은 절차로 돌아옴

---

## 6-7 라우팅 테이블
- 라우팅 테이블에는 어떤 네트워크로 IP 패킷을 전송하기 위한 경로가 등록되어 있음
  - 경로는 다음에 전송해야 하는 라우터
  - 테이블에 등록된 네트워크 정보를 루트정보나 경로정보라고 부름
- 경로 정보의 내용
  - 기업용 라우터는 주로 cisco system
  - 주요 내용은 목적지의 **네트워크 주소/서브넷마스크, 넥스트 홉 주소**
- 라우팅 테이블 상에서 인식할 수 없는 네트워크로 가는 IP 패킷은 모두 폐기
- ![라우팅 테이블 예시 사진](https://download.huawei.com/mdl/image/download?uuid=55787beeadb14c91accfa248542adbb3)

---

## 6-8 직접 접속
- 라우팅 테이블을 만드는 방법
  - 직접 접속
  - 스태틱 라우팅
  - 라우팅 프로토콜
- 기본은 **직접 접속**
  - 라우터가 직접 연결된 네트워크의 경로 정보
  - 직접 접속의 경로 정보를 라우팅 테이블에 등록하기 위한 특별한 설정은 필요 없음
  - 라우터의 인터페이스에 IP 주소를 설정하고, 그 인터페이스를 활성하기만 하면 됨
- 인터페이스에 IP주소를 설정하면 직접 접속된 경로 정보가 라우팅 테이블에 등록됨

---

## 6-9 스태틱 라우팅, 라우팅 프로토콜
- 직접 접속되지 않은 원격 네트워크의 경로정보
- **스태틱 라우팅**은 라우터에 커맨드를 입력하는 등 경로 정보를 수동으로 라우팅 테이블에 등록
  - 네트워크주소/서브넷 마스크와 넥스트 홉 주소를 커맨드로 입력하여 등록
- 라우터에서 **라우팅 프로토콜**을 활성화하면, 라우터끼리 정보를 교환해 라우팅 테이블에 필요한 경로 정보를 등록해줌
  - 주요 라우팅 프로토콜
    - RIP(Routing Information Protocol) - 소규모 네트워크 이용
    - OSPF(Open Shortest Path First) - 중규모 ~ 대규모
    - BGP(Border Gateway Protocol) - 인터넷 백본

---

## 6-10 경로 요약
- 모든 네트워크의 경로 정보를 라우팅 테이블에 등록하기는 어려움
- 넥스트 홉이 똑같은 네트워크를 일일이 등록하는 것은 의미 없음
- **경로 요약**은 넥스트 홉이 공통인 원격 네트워크를 하나로 모아 등록함

---

## 6-11 디폴트 경로
- 경로 요약을 가장 극단적으로 적용한 것이 **디폴트 경로**
- 0.0.0.0/0 = 모든 경로를 등록하면 모든 네트워크 경로 정보를 등록한 것이 됨
- 인터넷으로 라우팅하기 위한 경로 정보로서 디폴트 경로를 이용하는 경우가 많다

---

## 6-12 레이어3 스위치
- **레이어3 스위치**는 레이어2 스위치에 라우터 기능을 추가한 네트워크 기기
  - 레이어2와 라우터의 두개의 기능을 가짐
  - 같은 네트워크는 레이어2 다른 네트워크는 라우터
  - ![레이어2와 라우터 비교](http://www.theengineeringknowledge.com/wp-content/uploads/2021/03/Difference-Between-Router-and-Switch.jpg)
- 레이어2 스위치로도 라우터로도 사용할 수 있음
  - 이렇게 하기위해서는 **레이어 3 스위치는 VLAN(Virtual LAN) 기능**을 이용
  - 레이어3의 메커니즘을 알기 위해서는 VLAN 기능을 알아야 함

---

## 6-13 VLAN
- 레이어2 스위치는 하나의 이더넷 네트워크를 구성하는 네트워크 기기
- 하나의 네트워크에 수많은 기기를 연결하면 불필요한 데이터 전송이 많이 발생
- 레이어2 스위치는 보통 하나의 네트워크를 구성하지만, 레이어2 스위치에서 **네트워크를 복수로 분할할 수 있게하는 것이 VLAN**
- 동작 원리
  - 레이어2 스위치를 나누어 같은 VLAN에 할당된 포트끼리만 이더넷 프레임을 전송케함
  - ![그림 예시](https://www.computernetworkingnotes.org/images/cisco/ccna-study-guide/vlan-example.png)

---

## 6-14 VLAN 이용의 장점
- VLAN은 레이어2 스위치를 분할함
- 분할할 VLAN의 스위치가 될 포트는 설정하기 나름으로 자유롭게 설정 가능
- 데이터가 전송되는 범위를 제한하기 때문에 보안적으로도 좋음
- VLAN으로 분할한 네트워크가 서로통신하기 위해서는 라우터와 레이어3 스위치가 필요

---

## 6-15 태그 VLAN, IEEE802.!Q
- 복수의 스위치에 걸쳐 VLAN을 구성할 수 잇으나 스위치 간의 연결이 필요함
- 스위치 사이를 효율적으로 연결하기 위해서 **태그 VLAN(트렁크)포트**가 있음
- 태그 VLAN
  - 레이어2 스위치 간의 연결을 한 줄로 해결
  - 송수신하는 이더넷 프레임에 VLAN 태그가 추가됨
  - 레이어 2스위치가 VLAN태그로 VLAN을 식별하여 동일 VLAN 포트끼리 이더넷 프레임 전송
  - VLAN 태그는 IEEE802.1Q로 규정되어있음

---

## 6-16 VLAN과 태그 VLAN
- 태그 VLAN 포트 = 할당한 VLAN 별로 분할할 수 있는 포트
- VLAN은 레이어2 스위치를 가상으로 분할 / 태그 VLAN은 포트를 VLAN별로 가상으로 분할
- 기기 추가나 배선을 변경하지 않고 네트워크를 자유롭게 바꿈
- ![VLAN예시](http://labnario.com/wp-content/uploads/2017/06/vlan_trunk_vlanif_topology.png)

---

## 6-17 VLAN간 라우팅
- VLAN은 분할하기만 함
- VLAN간 통신을 위해서는 VLAN을 통신할 수 있게 **VLAN 간 라우팅**을 설정해야 함
- 레이어3 스위치 내부에는 라우터가 있음
- VLAN간 라우팅을 실현하려면 라우터 또는 레이어3 스위치가 필요, 레이어3가 더 효율적은 VLAN간 라우팅
- IP주소를 설정해야 네트워크(VLAN)이 연결됨
  - 레이어3 스위치 내부의 **가상 인터페이스(VLAN)**에 IP 주소를 설정함
  - 레이어3 스위치의 포트 자체에 IP 주소를 설정

---

## 6-18 기본 게이트웨이
- PC나 서버 등 TCP/IP를 이용하는 모든 기기에는 라우팅 테이블이 있고, 라우팅 테이블에 따라 라우팅함
- PC에 라우팅 테이블에 IP 패킷을 전송하고 싶은 모든 네트워크를 등록해두어야 함
- 