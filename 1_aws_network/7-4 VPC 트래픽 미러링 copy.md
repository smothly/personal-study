# 7-4 VPC 트래픽 미러링

## VPC 트래픽 미러링
#### 개요
- Traffic Mirroring이란 네트워크 환경에서 발생하는 트래픽을 복제하여 특정 장치로 전달하여 해당 정보를 모니터링할 수 있는 기능
- VPC 플로우 로그와 차이점
    - VPC 플로우 로그
        - VPC상 네트워크 플로우를 로그 형태로 ㅎ표현
        - 타깃: s3와 cloudwatch logs
        - 구조: 레코드 형태로 제한된 필드
    - VPC 트래픽 미러링
        - VPC상 트래픽의 실제 네트워크 패킷 정보를 수집
        - 타깃: 다른 ENI나 NLB로 전달
        - 구조: 실제 네트워크 패킷
    - 가장 큰 차이는 결과물이 로그와 패킷의 차이점
#### 구성
- 미러 소스(Mirror Source)
    - 트래픽 미러링을 수행할 대상
    - ENI를 미러 소스로 활용
- 미러 타깃(Mirror Target)
    - 복제된 트래픽을 전달한 목적지 대상
- 미러 필터(Mirror Filter)
    - 트래픽 대상 정의
    - IP대역이나 프로토콜 포트번호등을 지정
- 미러 세션(Mirror Session)
    - 미러소스와 타긴 간의 연결을 말하는 단위

---

## VPC 트래핑 미러링 동작 및 제약사항
#### VPC 트래핑 미러링 동작
- ![VPC 트래픽 미러링](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F99399B485D1C21C027)
1. 복제된 트래픽을 전달받을 미러 타깃을 지정합니다. (target ec2의 ENI 지정)
2. 미러 필터를 구성
3. 미러 세션을 생성
4. SRC에서 발생한 트래픽을 미러필터 매칭 판단
5. 매칭 될 경우 트래픽 복제하여 미러 타깃에 전달, 이 때 해당 트래픽은 VXLAN 터널링에 의하여 보호되어 전달

#### 제약사항
- EC2 Nitro 유형만 지원
- 미러 소스와 타깃이 연결되어 있어야 한다. (같은 VPC 및 피어링 또는 게이트웨이)
- 미러 세션 수는 1000개 제약, 인터페이스당은 3개 제약
- 트래픽의 프로토콜 제약(ARP, DHCP, NTP, EC2 메타데이터 안됨)