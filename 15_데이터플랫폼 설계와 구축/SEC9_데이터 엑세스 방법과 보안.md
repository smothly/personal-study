# 데이터 엑세스 방법과 보안

- 데이터 플랫폼의 목적이 데이터 소비자가 비용 효율적이고 안전하고 편리하게 데이터를 사용하기 위함

## 9.1 데이터 소비자 유형

---

- DW 중심일 때 데이터 접근하는 방법은 BI툴임
- 다양한 소비자, 보안, 속도, 안정성을 만족해야 함
- 다양한 소비자
  - 인간: 보고서 열람, SQL 쿼리 실행, 가설확인을 위한 원시 데이터 접근
  - 애플리케이션: 추천, 유지보수 예측, ML APP등 데이터를 기반으로 의사결정을 내릴 수 있도록 하는 앱들이 많음
  - 특히, app의 경우 DW만으로는 응답속도와 같은 성능을 만족시킬 수 없음
  - 아래 사진처럼 **소비자 유형에 따라 적합한 데이터 계층을 접근**하는 형태가 되어야 함
  - ![다양한 소비자 패턴](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F01_Zburivsky.png)

## 9.2 클라우드 데이터 웨어하우스

---

- SQL을 사용하기 때문에 아직도 널리 사용된다
- BI와 리포팅 툴이 대부분 SQL기반이여서 호환성이 좋음

### Redshfit

- psql기반의 분산 관계형 클라우드 데이터 웨어하우스
- 노드에 각각의 cpu/mem을 할당 시켜서 데이터 쿼리를 병렬로 수행할 수 있음
- 관리는 AWS측에서 해줌. 데이터 복제나 네트워크 문제 등 다양한 인프라 관리를 대신해줌
- leader node가 클라이언트와 커넥션을 관리하고 쿼리 구문을 분석해서 컴퓨트 노드로 쿼리를 분배하는 역할을 담당함
- ![redshift architecture](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F02_Zburivsky.png)
  - 컴퓨터 노드 클러스터 크기 조정 가능
  - 컴퓨터 노드는 슬라이스로 다시 나눌 수 있음
  - 노드를 추가할 경우 데이터 슬라이스를 조정해야하기 때문에 쿼리 실행 성능에 부정적인 역할을 줌
  - 데이터 분배방식 결정 가능
    - all: 각 컴퓨터가 테이블 전체 복사본 가져야 함. 자주 join해야하는 작은 테이블에 적용하면 효과적 
    - even: 컴퓨터 노드들로 고르게 분배
    - key: 특정 컬럼으로 분배. 2개 테이블이 같은 컬럼으로 분배되어 있고 join한다면 네트워크이동이 없어 효율적임
    - auto: ALL -> EVEN
  - sortkey를 통해 물리적 정렬 가능
  - 압축알고리즘과 인코딩 적용하여 데이터 크기를 최적화할 수 있음
- redshift spectrum 기능 제공
  - redshift 내부 최적화는 이용하지 못해 속도는 느림
  - eda나 dw로 가져올지 등을 결정할 때 많이 사용
  - 용량이 큰 작업을 로드 없이 쿼리할 때도 사용
  - Spark로도 할 수 있으나 DW방식이 익숙할 수도 있음

### Azure Synapse

- Parallel Data Warehouse
- redshift와 유사하지만 몇가지 차이점이 있음
- ![synapse architecture](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F04_Zburivsky.png)
  - 컨트롤 노드와 컴퓨트 노드로 구성됨
  - 시냅스는 스토리지 계층이 분리되어 있음
  - 클러스터 확장을 간단하고 빠르게 할 수 있음. 재분산 대신 매핑정보만 변경하면 됨
  - 클러스터 확장은 오프라인에서 작업해야돼서 확장성은 좋지 안흥ㅁ
  - 데이터를 이동할 필요가 없어 중지하고 시작할 수 있음
  - 노드 유형과 노드 수를 직접 지정할 수 없이 DWU라는 단위를 사용
  - 분배 옵션
    - HASH: 컬럼
    - ROUND ROBIN: 고르게 분배
    - REPLICATE: 전체 분배
  - 컬럼 압축 가능
  - 반구조 타입은 지원하지는 않고 json 데이터를 읽어 파싱하는 기능들만 제공
  - 온디맨드 풀로 blob storage에 쿼리 가능. serverless로 수행됨
  - 스파크 풀로 blob storage에 쿼리 가능. 최소 3개의 컴퓨터 노드가 필요

### Google Bigquery

- RDB기반이 아님
- 노드를 프로비저닝 할 필요 없이 slot을 할당하여 바로 사용할 수 있음
- ![bigquery architecture](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F05_Zburivsky.png)
  - 트리형태의 아키텍처로 루트 - 중개 - 리프로 구성됨.
  - 중개 노드에서 작업 전송, 결과 집계 등을 담당하며 3tier 아키텍처가 되어 노드 수 확장 가능
  - data locality를 고려하지 않고 구글 네트워크를 사용하여 충분한 처리량과 짧은 지연 시간을 제공함
  - dremel 기반
    - 로그 파일을 분석할 수 있도록 개발된 시스템
    - 반정형 데이터 기본 지원함. 각 Json 속성을 하나의 컬럼으로 저장함
- 스캔양에 따른 비용 지불
- 튜닝 부분은 파티셔닝과 클러스터링키만 있음.
  - 파티셔닝은 물리적 분할
  - 클러스터링은 데이터를 물리적으로 구조화하고 정렬. 정렬하거나 집계할 때 좋음
- REST API로 통신하기 때문에 성능문제나 JSON데이터를 처리하지 못하는 경우도 발생
- 외부테이블 지원해서 cloud sql, cloud storage에 쿼리할 수 있음
- bigquery omni라는 서비스로 다른 클라우드에 빅쿼리 소프트웨어 설치 가능

### 적합한 데이터 웨어하우스 선정하기

- 현재 공급업체와
- 다른 클라우드로 데이터 전송 비용 고려해야 함
- ![DW 고려사항](https://drek4537l1klr.cloudfront.net/zburivsky/HighResolutionFigures/table_9-1.png)

## 8.3 어플리케이션 데이터 엑세스

---

- 애플리케이션에서 데이터를 활용하는 용도가 높아짐
- 대부분의 애플리케이션에서 ms단위의 지연시간을 요구함
- 요구사항
  - 어플리케이션에 노출
  - 대화형
  - 빠른 응답시간
  - 데이터 플랫폼의 데이터 활용
- DW에서는 많은 동시성을 처리하지 못함
- 인터넷 어플리케이션일 경우 DW의 보안 문제도 있음


### RDB

- 관리형 디비를 사용해서 백업 자동화, 운영체제 패치, 복제 등의 기능을 활용할 것

### key-value 데이터 저장소

- 키의 값을 가져오는 지연시간이 상당히 작음
- 구글 빅테이블은 HBase를 이관할 때 좋음

### 전문 검색 서비스

- 구조화가 잘 되지 않아 fulltext-search를 하는 경우
- slor, es
- 문서의 속성을 인덱싱하여 사용
- 조인을 하지 않는 형태로 구성

### 인메모리 캐시

- redis, memcached
- 데이터 영속성은 없어 캐시로만 운영됨
- 영속성을 원하면 별도로 적재 해야함


## 9.4 데이터플랫폼에서의 머신러닝

---

- 가장 적합한 알고리즘이나 라이브러리
- 트리이닝
- 검증 과정
- 규모의 데이터에 엑세스할 수 있어야 함
- 일련의 과정을 거침. 데이터 파악 -> 실험과정 -> 트레이닝 과정
- 수작업 최소화 필요. 데이터 셋 분할
- ML도구나 라이브러리마다 엑세스 방식이 다른데 제약이 발생한다면 모델을 자체적 방식으로 개발할려고할 수 있음
- 필요한 사항
  - 모든 기업 데이터에 엑세스 할 수 있어야 함
  - 컴퓨팅 환경의 확장성
  - 실험 환경 및 협업 도구

### 모델 라이프 사이클

- ![model life cycle](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F06_Zburivsky.png)
- 데이터셋 정리하는데 시간을 많이 씀
- ![ml in dataplatform](https://drek4537l1klr.cloudfront.net/zburivsky/Figures/CH09_F07_Zburivsky.png)
  - 데이터를 수집 및 공통 포맷으로 변환하는 데 시간을 많이 쓰는것을 플랫폼으로 해결
  - 작업의 결과나 동일한 데이터셋을 쉽게 고융할 수 있음
  - 학습 인스턴스를 쉽게 확장할 수 있음
  - 스토리지에서 데이터셋 분리 및 EDA 등 다양하게 활용 가능
  - 배포전에 실 데이터로 테스트 해볼 수 있음
- 장점
  - 동일한 데이터셋으로 협업하여 피드백 주기 단축 + 생선성 향상
  - 데이터를 로컬에 저장 없이 클라우드 환경에서 바로 수행 가능
  - 데이터 과학자의 수작업(데이터 변환, 분할 등)을 줄여줌

### ML 클라우드 협업 툴

- azure ml은 end-to-end 모델 라이프사이클 관리 기능을 제공
- aws sagemaker 모델 개발과 트레이닝을 위한 통합 개발환경 제공
- google은 AI 플랫폼 제공

## 9.5 비즈니스 인텔리전스와 리포팅 툴

---

### BI툴과 클라우드 데이터 플랫폼 통합

- 가정
  - 데이터는 flat
  - 여러가지 목적으로 분할 및 세분화 가능해야 함. drill down
- 빅쿼리는 RDB가 아니라 지원하는지 꼭 살펴볼 것. (요즘은 다 지원되는듯)
- BI툴에 데이터 레이크 연결은 가능하나 편의성, 응답성 측면에서 이슈가 발생함. 그래서 DW가 표준 구성 요소로 꼭 필요함


### BI툴로 엑셀 사용하기

- 일반적으로 커넥터를 지원해서 연결은 가능하지만 보안이슈와 데이터셋이 커질경우 성능이슈가 생김

### 클라우드 공급 업체 서비스에 포함돼 있지 않은 BI 툴

- 어디걸 쓰는 것보다 내부 기술 경험이 더 중요함
- 데이터 egress비용만 계산하면 됨

## 9.6 데이터 보안

### 사용자, 그룹 및 역할

- 그룹 수준의 사용 권한을 관리하기
- 최소 권한 부여 원칙을 위해 우선 운영해보고 판단하기

### 자격 증명 및 설정 관리

- 비밀 키를 하드코징하지 않도록 하기. cloud native 인증 서비스를 활용하여 공유 키 사용 최소화 하기
- 퍼블릭 호스팅을 설정 하다가 전체 허용을 하는 불상사 방지해야 함

### 데이터 암호화

- 특정 컬럼이나 사용자 그룹만 암호화하여 저장 가능

### 네트워크 바운더리

- 네트워크/보안팀과 논의하여 접근할 수 있는 바운더리를 명확히 지정할 것


## 요약

---

- 데이터 소비자가 필요에 따라 비용효율적이고 안전하게 데이터를 활용할 수 있도록 하기 위함
- 데이터 소비자는 사람과 애플리케이션
- 클라우드간 DW 차이점 알기
- DW는 BI툴이나 SQL로 데이터 접근하는 주요 솔루션
- 어플리케이션 전용 데이터 저장소를 사용하여 데이터 조회 시간 단축시키기
- 애플리케이션 DB로는 nosql, fulltext-search system, cache db, rdb가 있음
- 데이터 보안 접근 방식 필요. 그룹, 역할, 자격 증명, 네트워크 바운더리, 데이터 암호화
- 데이터 과학자는 대규모 데이터를 엑세스, 상당한 컴퓨팅, 데이터셋 분할 등으로 접근을 하며 ML툴을 사용하는데 이슈가 없도록 다양한 엑세스 방법 (SQL, file, spark)를 제공해주어야 함
- ML 툴과 BI 툴 잘 활용 해볼 것