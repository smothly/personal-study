# 빅 3(aws, gcp, azure)의 활용과 확대

- 데이터 플랫폼에서 필요로 하는 핵심 기능과 고급 기능
  - 확장성
  - 3V 대응

## 3.1 클라우드 데이터 플랫폼 레이어 아키텍처

---

- 수집, 저장, 처리, 서비스 4개 레이어에서 **메타데이터 레이어과 오버레이 레이어**가 추가됨
- ![6계층](https://edwardthienhoang.files.wordpress.com/2023/02/image-9.png)

### Ingestion Layer

- 소스 시스템에 연결해 데이터를 가져오는 역할
- 스트리밍, 배치 두가지 모드로 가져옴
  - 실시간의 의미
    - 데이터가 수집되자마자 분석이 가능한 형태로 만들기 = 실시간 수집
    - 데이터가 수집되는 즉시 분석하여 조치 ex) 부정행위, 추천시스템
    - 아직 실시간 분석이 많이 필요없으나 보고서 대시보드의 시점을 최신 상태로 유지 가능하여 요구사항에 따라 구축
- **소스와 같은 원시 데이터를 보관**해야 함. 그래야 재처리할 때도 소스의 연결 필요없이 처리 가능
- 메타데이터 저장소에서 수집 통계, 상태를 알 수 있어야 함. ex) 시간당 데이터 수집량
- 어떤 수집이든 일급 객체로 구축해야 견고한 아키텍처가 됨
  - 일급객체
    - 다른 객체들에 적용 가능한 연산을 모두 지원하는 객체. 함시 인자로 넘기기 변수 대입 등을 지원
    - 클라우드에서 이 개념을 적용하면 **제약 없는 리소스**
- 람다 아키텍처
  - 실시간 분석 + 정확한 분석을 위해서 배치와 스트리밍을 모두 지원해야 함
  - 처음 나오게 된 배경은 하둡초기인데 회복성과 정확성을 보장하기 어려웠기 떄문임. 현재 클라우드 서비스에서는 많이 극복함
- 효율적이고 안정적인 수집 특성
  - Pluggeable architecture: 큰 노력없이 새 커넥터 유형 추가
  - Scalability(확장성): 대량의 데이터 처리 가능
  - High Availability(고가용성): 장애 대응 체계가 있어야 함
  - Observability(관측 가능성): 데이터 이동에 대한 가시성. 처리량, 지연 시간 등

###  고속 스토리지와 저속 스토리지

- 고속 스토리지
  - 스트림 방식 데이터를 메시지 단위로 데이터 처리하기 위한 메시지 버스
    - 컴퓨팅 서버가 필요하고 비용도 비쌈
  - persistence queue
  - 실시간 속성
- 저속 스토리지
  - 배치 데이터 저장 영역. 영구 보관
  - 객체 스토리지
    - 장점: 컴퓨팅 서버가 없어 확장성이 좋고 비용 효율적
    - 단점: low-latency를 지원하지 않음. 이를 위해 고속스토리지(큐)를 활용해야 함
- 스토리지가 가져야 할 특성
  - Reliable(안정성): 데이터 지속 유지
  - Scalable(확장 가능성)
  - Performant(성능): 배치는 읽기 성능 실시간은 Low-Latency
  - Cost Efficient(비용 효율성)

### 처리 계층

- 비즈니스 로직 적용, 데이터 검증, 데이터 변환이 수행 되며 ad-hoc 접근 가능
- 데이터 소비자들이 데이터를 스토리지에 다시 저장할 수 있어야 함
- 다른 시스템에도 데이터를 제공할 수 있어야 함
- apache beam은 배치와 실시간을 동시에 처리할 수 있음
- 처리 계층이 가져야 할 특성
  - 스케일 아웃: PB까지 처리가능해야 함
  - 배치와 실시간 처리 둘다 지원해야 함
  - 프로그래밍 언어 지원
  - SQL인터페이스는 있으면 좋은 조건. 생산성 향상

### 기술 메타데이터 계층

- 데이터 플랫폼 계층들의 처리상태에 대한 정보를 저장함
  - 스키마 정보
  - 수집 상태 정보
  - 파이프라인 상태+계보 정보
  - 데이터 통계 정보
- 각 계층에서 저장소의 메타데이터를 읽고, 추가 변경할 수 있도록 인터페이스 제공
- 메타데이터 계층이 가져야 할 특성
  - Scalable(확장성)
  - HA: 모든 처리 계층이 바라봐야해서 SPOF가 될 가능성이 높음
  - Extendable(확장 가능): 메타데이터 종류가 정확히 정해져 있지 않아, 확장 가능한 형태로 되어야 함
- 모든 요구사항을 만족하는 솔루션은 없음 ex) confluent schema registry, glue

### 서비스 계층과 데이터 소비자

- 관계형 데이터 구조와 SQL지원을 원하는 데이터 소비자는 DW를 활용하기 희망함
  - DW의 역할은 사용자가 요청하는 **쿼리결과를 신속하게 제공하는 것**이 그 역할
- 특성
  - Scalable and reliable
  - no ops: 운영 포인트가 최대한 적어야 함
  - elastic cost model: 사용량에 따른 분석비용 청구 ex) 평일 9시에 집중됨
- DL 접근은 DS분들이 많이 사용
  - 원시 데이터와 많은 양의 데이터 접근
  - DW의 부하를 주지않기 위함
- **실시간 분석 파이프라인의 경우 대부분 애플리케이션이 소비자**임

### 오케스트레이션 오버레이와 ETL 오버레이 계층

- 다양한 툴로 분산되어 있음
- orchestration layer = workflow
  - dependency graph를 기반으로 여러 데이터 처리 작업을 조정할 수 있어야 함
  - 작업 실패와 재시도 관리
  - 느슨하게 결합된 각 계층간의 흐름을 구성하는 역할
  - 가져야 할 특성
    - Scalability
    - HA
    - Maintainability(유지보수성)
    - Transparency(투명성): 모니터링에대한 가시성이 제공되어야 함
  - ex) airflow, gcp cloud composer, oozie
- etl tool overlay
  - 데이터 파이프라인을 더욱 쉽게 구현하고 관리하도록 하는 제품
  - UI나 No code방식의 개발이 가능
  - 역할
    - 데이터 수집
    - 파이프라인
    - 메타데이터
    - 오케스트레이션
  - 그러면 단일 툴로 가능한가?
    - 경우에 따라 그럴 수 있다
    - 확장 가능한지, 신규 컴포넌트 추가 가능한지, 외부 데이터 처리 가능한지, 오픈소스와 통합가능한지
    - 초기에는 좋을 수 있으나, 어떤 시스템도 정적이지가 않음
  - 가져야 할 특성
    - Extensibility: 컴포넌트 쉽게 추가
    - Integrations: 일부 작업은 다른 데서 가능한지
    - Automation maturity: GUI가 초반 접근은 되지만, CI/CD와 자동화 테스트 등 유지보수가 편한 형태가 되는지
    - Cloud Architecuture fit: 대부분 on premise형태, 
  - glue, data factory, cloud data fusion
  - 