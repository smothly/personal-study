# 데이터 웨어하우스만이 아닌 데이터플랫폼인 이유

- 왜 클라우드 데이터 플랫폼을 착수해야 하는지!

## 2.1 클라우드 데이터 플랫폼과 클라우드 데이터 웨어하우스: 실용적 측면

---

- 예시: 리포팅 솔루션
  - rdbms 데이터와 click stream(마우스 클릭 기록)
  - 클릭스트림은 nested json을 컬럼으로 가짐
  - 아래작업을 반복 수행
    - 캠페인 데이터와 클릭 스트림 데이터를 조합하기
      - 캠페인의 링크를 통해 들어온 사용자
      - 사용자가 어떤 사이트들을 방문했는지 식별
  - Azure Synapse를 온프레미스 데이터 웨어하우스로 가정
- Cloud DW만 활용한 사례
  - ![only dw](https://edwardthienhoang.files.wordpress.com/2023/02/image-3.png)
  - azure data factory를 활용하여 ETL
- Cloud Data Plaform 활용한 사례
  - DL + DW
  - ![cdp](https://edwardthienhoang.files.wordpress.com/2023/02/image-4.png)
  - DW만 사용할때와 차이점은 data factory를 사용하여 blob storage에 저장
    - 원천 데이터 형식 보존
    - 데이터 다양성 문제 해결
  - 데이터 처리는 Databricks(Spark)로 진행
    - spark엔진으로 스파크 클러스터를 쉽게 만들고 노트북 환경으로 빠른 처리 가능
    - 대화형으로는 적절하지는 않음. BI 같은 경우도 DW가 더 사용하기 편함
    - DW의 데이터 처리 부담을 덜어줌

## 2.2 데이터 수집

---

- DW로 직접 ETL하는 경우 소스와 타겟에 스키마를 알아야 함. 소스쪽은 자동으로 가져오지만 타겟은 데이터를 유추하면서 생성한다.
- CDP로 수집할 경우 **스키마를 미리 지정할 필요가 없음**
  - 파일의 유연성을 가지고 처리를 더 효율적으로 할 수 있음
  - 수백 개의 테이블을 오류없이 옮기기 쉽지 않음 + 변경이 발생했을 때 회복하기 편함
- 업스트림 스키마가 변경되면 데이터 웨어하우스 수집 파이프라인에 문제가 발생할 수 있음
  - ETL 툴을 사용할 경우 스키마 변경이나 신규 컬럼 추가 작업이 가능한 경우가 있음. 하지만 **Table Lock이나 데이터 크기에 따른 스페이스 조정 등 스키마 변경 자체가 어려운 경우들이 많음**
  - 업스트림 파이프라인이 DL에 있을 경우 오류가 발생하지 않음. but **소스 스키마 변경 사실을 모를 수가 있음**

## 2.3 데이터 처리

---

- SQL vs Spark의 관점
- DW에서 처리
  - JSON데이터는 `JSON_VALUE` 함수를 사용하여 필드를 엑세스할 수 있음. 또는 UDF를 활용함
    - ![aa](https://davidalzamendi.com/wp-content/uploads/2020/08/No-code-experience-for-querying-JSON-files-in-Azure-Synapse-Analytics.png)
  - 두 방법의 단점
    - 문자열 파싱이 많이 필요하고 ETL 처리 시간이 발생할 수 있음
    - 가독성이 낮음
    - 테스트 과정이 쉽지 않음
    - columnar한 스토리지 기반의 DW인데 Json은 최적화가 되지 않음
- CDP에서 처리
  - SQL, python, scala가 가능하여 유연성, 가독성, 테스트 용이성이 더 높음
  - DW에 비해 장점
    - **코드의 모듈화 테스트 용이**
    - 코드를 범용적으로 이해 가능하도록 유지 관리하는 것이 향후에 큰 도움이 됨

## 2.4 데이터 엑세스

---

- 다양한 관심
  - 마케팅 팀: 캠페인 마다 상위 10개 페이지 뭔지
  - 데이터 분석가: 데이터 분할 및 가공
  - 데이터 과학자: 페이지에 따라 사용자를 프로필별로 구분
- 위와 같은 다양한 관심을 해결하는데 데이터 플랫폼이 필요
  - 사용자나 데이터 분석가는 DW기반이 유용
    - 처리 계층에서 타겟을 DW로 두면 됨 이부분은 유연성 증대에도 좋음
  - 과학자는 다양한 데이터 소스가 필요하고 분산처리가 필요함

## 2.5 클라우드 비용 고려사항

---

- DW가 가장 많은 비용을 차지할 것임. 하지만 탄력성(사용하는 만큼만 과금)이 좋지는 않음
- DL + 분산처리가 탄력성 관점에서 볼 때 비용통제면에서는 우세함

|DW|CDP|
|---|---|
|소스가 RDB에 특화|반정형 데이터부터 **여러 데이터 소스 수집** 가능|
|소스 데이터 통제권과 스키마 변경 관리를 위한 프로세스 필요|데이터상관 없이 저장 가능|
|BI 리포트 툴과 대화형 SQL 쿼리로 use case제한|**ML/AI로의 use case**|
|데이터 소비자 제한|엑세스하는 사용자 점점 증가|
|모든 데이터를 처리할 경우 비용이 합리적|각 계층마다의 비용 최적화가 필요|

## 요약

---

- JSON 해결해보면 데이터 플랫폼이 필요(다양성, 성능)을 느낌
- 분명한 차이점은 스키마 대응이 쉬움
- SQL의 한계점 - 테스트, 확장성, 성능 최적화
- 분산처리의 확장성
- 플랫폼의 구축의 비용 시간이 많이 들지 않음
- 스트리지 컴퓨팅 비용이 별도여서 최적화 해나가기 쉬움
- 다양한 use case 대응 가능
