# CH05 1단계: 원천 시스템에서의 데이터 생성

---

## 데이터 원천: 데이터는 어떻게 생성될까?

---

- 아날로그, 디지털, IOT, DB 등 다양한 곳

## 원천 시스템: 주요 아이디어

---

- 파일
- API
- APP DB(OLTP)
  - 짧은 지연 시간과 높은 동시성을 지원
  - ACID
    - 원자성: 송금처럼 하나의 트랜잭션으로 움직여 전체 성공 또는 실패하는 것
    - 일관성: 마지막으로 기록된 항목 반환
    - 독립성: 동시 실행이면 제출된 순서에 따라 순차적으로 실행
    - 내구성: 정전 시에도 커밋된 데이터가 손실되지 않음
- OLAP
  - 대량의 데이터를 스캔하도록 최적화 되어 있음
- CDC
- 로그
  - 누가, 무엇을, 언제 수행했는지
  - os, app, container, iot, network
  - 인코딩
    - 바이너리
    - 반정형
    - 일반 텍스트
  - 해상도
    - 로그의 양으로 모든 이벤트만 기록할 지 에러만 기록할지 같이 레벨단위로 남길 수 있음
- DB 로그
  - 복구용으로 쓰임
  - CDC로 이벤트 생성할 때 유용
- CRUD
- 입력 전용 패턴
  - 고객 주소 이력 같이 append형태로 데이터 적재
  - 단점
    - 최신 데이터 조회할 시 Max(timestamp) 오버헤드
    - 데이터 크기 무한정 증가
- 메시지와 스트림
  - 메시지는 단일 신호로서 메시지가 수신되면 메시지 큐에서 삭제됨
  - 스트림은 이벤트가 순서대로 누적되며 보존 기간을 설정할 수 있음
- 시간 유형
  - 시간들이 자동으로 기록되도록
    - 이벤트 시간
    - 수집 시간
    - 처리 시간

## 원천 시스템의 실질적인 세부 사항

---

- DB
  - DBMS, 조회, 쿼리 옵티마이저, 확장과 분산, 모델링 패턴, CRUD, 일관성
  - RDBMS
    - 데이터가 행단위로 저장됨
    - 기본 키에 의해 인덱싱됨
    - ACID 준수
  - NoSQL
    - 관계형 제약 조건을 해제하여 성능, 확장성, 스키마 유연성을 늘릴 수 있음
    - 강력한 일관성, 조인, 고정 스키마의 특성은 포기
    - key-value
      - 초고속 검색과 높은 동시성이 요구될 때 쓰임 ex) 세션
      - 높은 내구성과 지속성 요구될 때도 쓰임 ex) 전자상거래 내 주문
    - document
      - 도큐먼트는 중첩된 객체. json으로 볼 수도 있음
      - 컬렉션(=테이블)에 저장되고 키로 검색 됨
      - 정규화할 수 없어 조인을 지원하지 않음
      - 스키마가 매우 유연하나 데이터가 비대해 질 수 있고 다운스트림에 영향을 끼칠 수도 있음
      - 결과적으로 일관성을 유지함
      - 쿼리 속도를 높이기 위해 인덱스를 생성 함
    - wide-column
      - 빠른 쓰기 속도(10ms미만)와 방대한 양(PB)의 데이터 확장
      - iot, 핀테크, 실시간 개인화 등에 많이 쓰임
      - 복잡한 쿼리를 지원하지 않고 인덱스는 오직 1개뿐임
    - graph
      - 요소간 연결성을 분석할 때 유용
      - 노도와 에지를 저장
      - 읽기 중심의 그래프 분석을 주로 지원
    - search
      - 텍스트 검색과 로그 분석
      - 인덱스를 사용하면 쿼리를 최적화하고 속도를 높일 수 있음
    - time-series
      - 시간별로 정리된 일련의 값
      - 측정 데이터와 이벤트 기반 데이터로 나뉨
      - 타임스탬프: 필드값
      - 조인은 주로 지원하지 않음
- API
  - REST
    - stateless
    - wrapping된 특정 데이터 모델
  - GraphQL
    - 단일 요청으로 여러 데이터 모델 검색 가능
    - JSON을 중심으로 구축됨
  - 웹훅
    - 이벤트 기반 데이터 전송 패턴
    - 다운스트림을 트리거 하거나 데이터 저장
  - RPC와 gRPC
    - 원격 프로시저 호출
    - 구글에서 만든 `protocal buffers open data serialization standard` 기반으로 구축됨
    - HTTP/2 기반의 효율적인 양방향 데이터 굔환을 강조
- 데이터 공유
  - 테넌트 간의 데이터 공유를 위한 보안 정책을 지원
  - 데이터 메시와 같은 분산형 데이터 관리 패턴을 촉진함
- 서드파티
  - 서드파티는 무한대에 가까움
  - API를 통해 pull/push 하여 데이터를 받음
- 메시지 큐와 이벤트 스트리밍 플랫폼
  - 이벤트 기반의 실시간 분석의 니즈가 많아지고 있음
  - 마이크로서비스간에 메시지를 라우팅하는 용도로도 많이 쓰임
  - 메시지 큐는 메시지를 버퍼링해 일시적인 부하 급증을 처리함
    - 메시지 순서 지정 및 전달
      - FIFO가 항상 아니라는걸 염두해두고 설계해야 함
      - 적어도 한 번과 같이 여러번 수행되는 경우가 있음. 멱등성 상태가 되도록 설계해야 함
      - 확장성이 좋아야 함
  - 이벤트 스트리밍 플랫폼
    - 토픽
      - 관련 이벤트 모음
    - 스트림 파티션
      - 파티션 키에 따라 여러 스트림으로 분할 됨
      - hotspoting 한쪽 파티션에 몰리지 않도록 파티션 키를 잘 설정해야 함
      - 내결함성과 복원성: 노드가 다운되면 다른 노드를 대체해 스트림에 계속 접근할 수 있음

## 함께 작업할 대상

---

- 이해관계자와 데이터 계약을 체결할 것
  - 어떤 방법, 얼마나 자주, 어떤 데이터 추추, 원천 시스템 담당자
  - 표준화된 형식으로 개발해 프로세스에 통합하거나 프로그래밍 방식으로 쿼리
- SLA/SLO 설정과 같이 보증 관련 기대치를 설정할 것

## 드러나지 않는 요소가 원천 시스템에 미치는 영향

---

- 보안
  - 데이터 암호화
  - 공용 인터넷
  - 비밀번호, 토큰, 자격 증명 안전하게 보관
  - 비밀번호 동일한 규칙
  - 원천시스템 신뢰
- 데이터 관리
  - 거버넌스: 신뢰성 높고 이해하기 쉬운 방식
  - 품질, 무결성: 기대치 설정 필요
  - 스키마: 스키마 변경 알림 받기
  - 마스터 데이터 관리
  - 개인정보보호와 윤리
  - 규정
- 데이터 옵스
  - 예기치 않은 장애, 업데이트시 영향도 체크 및 데이터 사용 가능한지
  - 고려 사항
    - 자동화
    - 관찰 가능성: 모니터링, 알람
    - 사고 대응
- 데이터 아키텍처
  - 신뢰성
  - 내구성
  - 가용성
  - 사람
- 오케스트레이션
  - 주기와 빈도
  - 공통 프레임워크
- 소프트웨어 엔지니어링
  - 네트워킹
  - 인증과 권한
  - 접근 패턴
  - 오케스트레이션
  - 병렬화
  - 배포

## 결론

---

- **원천 시스템 팀과 협업하여 데이터 품질 향상, 결과 달성 및 데이터 제품 개선으로 이어지게** 하기
- 원천과 통합이 증가하고 있어 공유 시스템이 기반이 되어야 함
- 어플리케이션 팀이 데이터 엔지니어링에 관여하고 성공을 공유할 방법을 찾아보자
