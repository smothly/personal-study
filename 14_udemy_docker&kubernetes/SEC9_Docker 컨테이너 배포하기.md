# SEC9 Docker 컨테이너 배포하기

---

## 모듈 소개

---

- 로컬 머신에서 동작하는 것을 리모트 머신에도 동작하도록 하기
- 주의할 점
  - 바인드 마운트 사용하지 말기
    - 컨테이너는 런타임 환경을 캡슐화해야하지만 코드는 캡슐화할 필요가 없음
    - 로컬호스트에 코드를 바로 실행하고 수정하면 즉각적으로 반영됨
    - 리모트 머신은 코드를 가지고 있으면 안됨. 그래서 바인드 마운트 대신 copy를 사용함
    - volume 옵션을 사용한 이유는 Dockerfile에서 명시하지 않기 위해서 였음
  - 컨테이너화된 앱에는 빌드 단계가 필요할 수 있음
  - 멀티 컨테이너 프로젝트는 여러 호스트 / 원격 머신에 분할되어야 함
  - 호스트/원격 머신 제어와 책임사이의 균형을 맞출 가치가 있을 수 있음
- SSH


## AWS EC2 배포

---

- 대부분 아는 부분이라 빠르게 넘김
  - VPC + 보안그룹 구성
  - EC2 생성
  - SSH 연결
  - Docker 설치
- 배포에 2가지방법
  - 소스코드 배포
    - 리모트 머신에서 이미지를 빌드
  - 이미지 배포
    - 호스트 머신에서 이미지를 빌드
    - 리모트 머신에서는 이미지를 가져와서 실행
- `.dockerignore` 파일을 사용해서 빌드할 때 불필요한 파일을 제외할 수 있음
  - `.gitignore`와 비슷한 역할
  - `node_modules`를 제외하고 빌드하면 빌드 시간이 단축됨
- docker hub에 배포
  - docker build
  - docker tag
  - docker push
- docker hub 이미지로부터 run하기
- 보안그룹 허용
  - 아웃바운드는 전부 허용되어 Docker Hub와 통신 가능
  - ssh 인바운드 규칙은 열려고 키파일로 접근 가능
  - 80 포트로도 접근할 수 있도록 인바운드 규칙 추가
- 도커설치만으로 컨테이너를 바로 띄울 수 있었음
- 이미지 및 컨테이너 관리
  - 수정하여 빌드하고 푸쉬한 새 이미지를 사용하기 위해선 `dockuer pull` 작업을 거쳐야 함
- 단점
  - do it yourself
    - 수동으로 생성 및 연결 했음
    - 서버의 책임은 본인에게 있음 ex) 보안그룹
    - ssh 연결도 해야함

## AWS ECS 배포

---

- control과 responsibility간의 균형을 잘 맞추면서 사용해야 함
- 완전 관리형 서비스
  - 리모트 호스트를 직접관리하지 않기 위함
  - 생성, 관리, 업데이트, 모니터링, 스케일링이 단순화 됨
- ECS
  - 더이상 도커 설치 및 명령어를 사용하지 않음
- 