# 비트코인 블록체인 동작 원리

## 2.1 비트코인 블록체인의 개념적 이해
- 닉슨 쇼크
  - 브레튼 우즈 체제에서 금을 돌릴 수 없는 여건이 되자 체제를 폐지해 버림
  - 시사점
    - **금본위제 기반 화폐 설계**: 화폐는 가치 기반으로 적정규모만 발행되도록 해야 한다.
    - **탈중앙화 시스템**: 중앙기관이 독점적을 운영하면 신뢰를 저버릴 수 있다.
    - **분산장부**: 관리 장부가 투명하지 않으면 뱅크런 같은 상태가 발생한다.
- 비트코인
  - 비트코인도 총 발행량이 2,100만 개로 희소성 보장, 10분단위 발행, 공급의 안정성
  - 누구나 참여가능한 탈중앙화 화폐
  - 동일한 장부를 모든 참여자에게 분산시켜 완벽한 투명성과 신뢰성을 보장
  - **블록체인**은 이 시스템을 실체화한 기반 기술
- 기존 화폐 시스템의 특징
  - 문제점
    - 중앙정보의 무분별한 화폐 발행
    - 상업은행의 신용창조
    - 장부와 권한의 독점
    - 전산시스템의 SPOF(Single Point Of Failure)와
    - 감독기관의 도덕적 해이 문제
    - 개인정보 및 금융정보 노출 가능성
  - 극복방안
    - 화폐발행 통제
    - 탈중앙시스템
    - 분산장부
- 구현 방안
  - 탈중앙시스템
    - 위 변조 차단 방안
    - 자발적 참여 유인 방안
  - 분산 장부
    - 분산된 장부의 합의
    - 이중지불 방지 방안
  - 금 본위제
    - 화폐 발행 규모
    - 화폐 발행 방식
  - 화폐시스템
    1. 탈중앙
      - 동등한 권한을 지닌 노드들이 네트워크로 연결된 구조
    2. 분산된 장부
      - 장부는 각 노드에 분산되어 저장. 동일한 장부를 모든 참여자에게 각각 분산시켜 참여자들 모두가 동일한 장부를 하나씩 소유 및 보관하여 투명성을 높임.
    3. 장부의 일치(합의)
      - 분산 장부에서 대표 장부를 하나 선정해서 다른 노드의 장부에 전파 및 동기화하는 방법으로 분산된 장부 간의 합의 및 일치에 도달 
    4. 합의된 장부 위변조 차단
      - 수정 삭제와 같은 민감한 권한에 대해서는 누구에게도 어떤 상황에서도 허용하지 않는 설계 방향이 필요
- 블록체인 관련 용어
  - 해시(Hash)
    - 해시함수란 임의 길이의 데이터를 Hash함수에 입력하면 고정된 길이의 랜덤(Random) 값을 출력하는 것
    - 특징
      - 랜덤한 고정 길이 출력값
      - 출력값으로 읿력값 유추 불가
      - 입력값의 사소한 변경에도 전혀 다른 출력값
    - 머클트리
      - ![이미지](https://cdn.banksalad.com/entities/etc/1532672338705-pc%20Group%207.png)
      - 트리구조로 연결된 해시값들이 전체가 변경됨
      - 데이터의 수정여부를 체크하기 쉬움
  - 암호와 비대칭키 암호
    - 비대칭 키
      - 대칭키의 키 배송 문제를 해결
      - 공개키와 개인키가 수학적 연관성을 기반으로 쌍으로 구성
      - 공개키는 외부에 공개 가능, 개인키는 외부에 공개하면 안됨
      - 공개키로 암호화하면 개인키로 복호화, 개인키로 암호화하면 공개키로 복호화
  - 노드(Node)
    - 블록체인 네트워크에 참여한 모든 컴퓨터 또는 사용자
  - 트랜잭션
    - 특정 작업을 정상적으로 처리하기 위한 논리적인 작업 단위
    - 비트코인 송금의 트랜잭션 예시
      - 송금자의 금액 확인
      - 수신자 계좌번호와 송금액 입력
      - 송금자의 잔고가 송금액보다 큰지 검증
      - 송금자 계좌에서 송금액만큼 공제
      - 수신자 계좌에 송금액만큼 증액
  - 블록(Block)
    - 최소 데이터 저장 단위들이 일정한 크기로 묶여 있는 상태
    - 구성
      - Body: 거래내역인 트랜잭션이 모두 저장되어 있는 영역
      - Header: 트랜잭션에 정보 요약 및 블록관련정보가 포함
      - Block Hash: 블록을 하나의 값으로 푠현한 대푯값으로 블록 식별 기준
      - [블록 구조 예시](https://miro.medium.com/max/1400/1*0M_FNSM70fKc2LEspDgXpg.png)
    - 블록을 장부(Ledger)라고도 많이 부름
    - 1MB정도 함
    - 개별 거래내역인 트랜잭션을 일정 시간 단위로 Body에 저장하고 해당 트랜잭션들에 대한 요약 정보를 Header에 포함한 형태 = Block
    - 이 블록을 체인형태로 연결하면 **블록체인**
  - 블록체인
    - 거래내역이 발생함에따라 블록이 계속 생성됨
    - 이전 블록의 해시값이 새롭게 생성되는 블록에 포함되는 방식으로 체인처럼 연결
    - [블록체인 연결 구조](https://img1.daumcdn.net/thumb/R800x0/?scode=mtistory2&fname=https%3A%2F%2Ft1.daumcdn.net%2Fcfile%2Ftistory%2F9976403E5A5D524132)
  - 기밀성 무결성 가용성
    - 기밀성(Confidentiality): 인가되지 않은 사람에게 노출되지 않도록 정보를 보호
    - 무결성(Integrity): 변경 및 위변조로부터 정보를 보호
    - 가용성(Availability): 정보의 훼손 및 파괴로부터 정보를 보호, 어떠한 상황과 환경에서도 서비스가 정상적이고 지속적으로 운영될 수 있는ㄴ 능력
  - 비트코인
    - 탈중앙 화폐 시스템
    - 용어 정리
      - 비트코인: 블록체인 기반 화폐시스템, 암호 화폐
      - 비트코인 블록체인: 비트코인 구현의 기반이 되는 블록체인
      - 이더리움 블록체인: 이더리움 블록체인 플랫폼
      - 비트코인 클라이언트 프로그램: 비트코인 네트워크에 참여하기 위해 노드에 설치하는 프로그램(Bitcoin Core)
      - 블록체인 플랫폼: 블록체인 기반의 다양한 서비스 구현을 위해 기반이 되는 블록체인
- 블록체인 구성도
  - 기본 구성도
    - 블록체인 구성도
    - 노드 구성도
      - 지갑: 개인키와 공개키가 보관된 영역
      - Memory Pool: 전파된 트랜잭션이 신규 블록 생성 이전까지 잠시 대기하는 저장소 영역
      - 블록체인: 블록체인이라는 장부가 저장되는 영역
      - 노드의 4가지 역할
        - 트랜잭션 생성: 지갑의 키를 활용하여 새로운 트랜잭션 생성
        - 검증: 트랜잭션이 네트워크 전체에 전파되었을 경우 검증
        - 블록 생성 및 채굴: 후보블록을 생성하고 채굴 과정을 거쳐 최종 블록 생성
        - 블록체인에 저장: 합의를 마친 블록을 블록체인에 연결하여 저장
    - 네트워크 구성도
      - 각 노드는 인터넷을 통해 모두 연결
      - 각 노드에는 동일한 장부(블록체인)이 모두 저장
      - https://bitnodes.io/
- 블록체인 작동 주요 절차
  - 유사한 사례(드롭박스)
    - 연결한 모든 디바이스의 파일은 클라우드 노드를 통해 전파 및 동기화 됨
    - 클라우드가 일종의 중앙시스템 역할을 하는 차이점은 있음
  - 주요 절차
    - 블록체인은 트랜잭션이 전파되면 바로 동기화되는 것이 아님
    - 각 노드가 전파된 트랜잭션들을 모아서 후보블록을 각각 생성
    - 각 노드에 있는 후보블록들이 경쟁하며 하나의 대표블록을 선정
    - 선정된 대표블록을 다시 전파
  - 트랜잭션 생성되고 전파되어 각 노드가 검증하는 과정
    - 지갑을 통해 거래(트랜잭션) 생성
    - 생성된 트랜잭션은 네트워크를 통해 모든 노드에 전파
    - 각 노드는 수신된 트랜잭션을 검증
    - 검증된 트랜잭션은 잠시 Memory Pool에 저장
    - 각 노드는 일정 시간동안 쌓인 트랜잭션을 모아서 노드별 후보블록을 생성
    - 후보블록 중 대표블록 생성(채굴)
    - 선정된 대표블록은 다시 네트워크를 통해 모든 노드에 전파
    - 각 노드는 수신된 대표블록을 검증
    - 검증된 대표블록은 각 노드에 저장된 블록체인에 연결