# 4장 클라우드 설정

- AWS를 이해해야 함
    - 사용자와 역할
    - 로깅 및 알람
    - 비용

---

## 보안 모델 및 자격 증명 관리
### IAM 사용자 생성 및 관리
- ARN = Amazon Resource Name
- IAM 사용자(User)
    - 서비스 계정이라고도 부름
    - 액세스 키를 사용하여 AWS 서비스 API에 접근
        - Access key id와 Secret Access Key로 이루어짐
        - User당 최대 두개의 활성화된 키를 가질 수 있음
    - Password설정하여 콘솔로그인도 할 수 있음
- MFA 설정 가능
- 임시자격증명도 가능

### 그룹 생성
- IAM 사용자 모음
- 그룹 정책을 기본으로 하고, 사용자 정책을 개별적으로 설정 가능

### 역할 생성
- 사용자, 어플리케이션, 서비스가 맡을 수 있는 권한 집합
- 위임은 특정자원에 대한 접근을 허용을 뜻함
- 연동은 외부 자격 공급자 또는 SAML 같은 자격증명 시스템간의 신뢰 관계를 생성하는 프로세스

### 자원
- AWS 권한은 자격 증명 기반 또는 자원 기반 
    - 자격증명기반 = IAM 사용자 또는 역할이 수행할 수 있는 것을 지정
    - 자원 기반 = 권한은 S3 또는 SNS 토픽과 같은 AWS 자원에서 수행
- 자원기반 정책으로 할경우 교차계정 액세스를 할 때 더 간편하게 할 수 있다. But 자원 기반 정책을 제공하는 서비스들에 제한이 있음

### 권한과 정책
- 어떤 자원에 접근하거나 작업을 수행할 수 있는 권한을 부여
- 최소 권한 집합을 추천
- 정책에는 두가지 유형
    - 관리형
        - 사용자 및 그룹 역할에는 적용되지만, 자원에는 적용되지 않음
        - 독립형
        - 일부 정책은 AWS 가 생성하고 관리
        - 재사용 및 변경 관리에 좋음
    - 인라인
        - 특정 사용자, 그룹 또는 역할에 직접 생성되고 붙음
        - 엔터티가 삭제되면 정책도 같이 삭제
        - 자원 기반 정책은 항상 인라인
    - principal, sid, condition
        - principal은 사용자나 계정 서비스의 접근 허용 지정
        - sid는 SNS와 같은 특정 서비스에만 필요
        - 정책 적용 조건
            - ex) HTTPS/SSL만 사용한 S3 접근
            

---

## 로깅 및 경고
- Cloudwatch는 모니터링하고 리소스에 대한 통계를 볼 수 있는 서비스
- Cloudtrail은 API 호출을 기록하는 서비스

### 로깅 설정
- Ladmbda 같은 경우 자동으로 로깅함
- EC2같은 경우는 에이전트를 설치하여 남김

### 로그 보존
- 자동으로 무기한 저장
- 기한은 설정 가능

### 필터, 지표, 경보
- 패턴을 지정하여 들어오는 log에 따른 지표 생성 경보 설정 가능
- 지표 필터
    - 패턴
    - 값
    - 지표 이름
    - 네임스페이스
    - 필터 이름

### 로그데이터 검색
- 로그 그룹을 선택하여 원하는 패턴으로 검색

### S3와 로깅
- s3에서도 로깅활성화 가능

### 경보에 대한 추가 정보
- 지속 시간, 오류, 호출 또는 지표를 모니터링하고 주어진 시간내에 이벤트 수에 따른 알림 설정

### CloudTrail
- 두 가지 유형
    - 모든 리전
    - 특정 리전

---

## 비용

### 결제 경보 생성

### 비용 모니터링 및 최적화
- Cloudchecker와 같은 서비스로 리소스 분석 비용 추적, 경보 보내기, 비용 절감 가능
- Trusted advisor 제공
- Cost explorer로 예측 및 보고서 생성 가능

### Simple Monthly Calculator 사용
- 예상 트래픽 및 서비스를 입력하여 비용 계산

### Lambda 및 API Gateway 비용 계산
- 500만번 256MB 2초동안 실행 => Lambda(36) + API Gateway(26) 하여 약 62달러- 

---

## 연습문제(생각해 볼 만한 것들) + 요약
- AWS 클라우드의 설정에 대한 알람이 대부분
- IAM + 로깅 + 비용

