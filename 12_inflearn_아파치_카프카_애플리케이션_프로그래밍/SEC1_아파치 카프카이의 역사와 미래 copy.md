# SEC1 아파치 카프카의 역사와 미래

---

## 1-1 아파치 카프카의 탄생과 기본 구조

---

- 탄생
  - 링크드인에서 소스/타겟의 어플리케이션이 증가함에 따른 데이터 전송의 어려움 때문에 탄생함
  - ![카프카](https://t1.daumcdn.net/cfile/tistory/9970863F5FDDA1231D)
- 카프카 구조
  - 프로듀서 > 토픽 - 파티션(큐 FIFO방식) > 컨슈머
  - 컨슈머가 데이터를 가져가더라도 파티션내에서 삭제가 되지 않음
  - 컨슈머가 파티션에서 데이터를 가져간 기록을 커밋을 통해 체크
  - ![카프카기본구조](https://baek.dev/assets/images/post/2020/2020_020_006.jpg)

## 1-2 아파치 카프카가 데이터 파이프라인으로 적합한 4가지 이유

---

### 1. 높은 처리량
  - **데이터를 묶어서 전송**하여 네트워크 통신 횟수 최소화
  - 데이터를 여러 파티션에 분배하여 **데이터를 병렬 처리**할 수 있음. 하여 파티션과 컨슈머 개수를 늘려 처리량 늘릴 수 있음
### 2. 확장성
  - 1개의 클러스터의 브로커를 최소로 운영하다가 데이터가 많아지면 **브로커를 스케일 아웃 가능**
  - 클러스터의 **무중단 운영**을 지원
### 3. 영속성(persistence)
  - 영속성: 프로그램이 종료되더라도 사라지지 않는 데이터의 특성
  - **데이터를 파일 시스템에 저장** = 영속성
  - i/o 성능 향상을 위해 캐시 메모리 영역 사용 = 처리량
### 4. 고가용성(high availability)
  - **3개 이상의 서버들로 운영**되어 일부 서버 장애 발생시 무중단으로 안전하게 지속적 처리 가능
  - 프로듀서로 저장 받은 데이터를 여러 브로커에 저장하기 때문에 복제된 데이터로 처리 가능함
  - 온프레미스/클라우드 둘다 안전하게 복제할 수 있는 브로커 옵션이 존재

## 1-3 빅데이터 아키텍처의 종류와 카프카의 미래

---

- 초기 빅데이터 플랫폼
  - 각 어플리케이션으로부터 데이터를 배치로 모아 전송함
  - 실시간 인사이트 기여가 힘들고 데이터 히스토리나 거버넌스도 관리하기 어려움
- 람다 아키텍처
  - 배치 레이어 / 서빙 레이어(서비스에서 데이터 사용) / 스피드 레이어(실시간) 3가지로 나뉘어 활용하는 방식
  - 한계: 수집레이어가 2개로 나뉘어 데이터를 융합하여 사용할 때 문제(디버깅, 배포,  파편화)가 생김
- 카파 아키텍처
  - 배치레이어를 제거하여 스피드 레이어를 통해서만 데이터 수집하도록 변경
  - **배치 데이터를 스트림으로 표현**함
    - 각 시점의 데이터 변환 기록을 순서대로 기록하여 모든 스냅샷 데이터를 저장하지 않고도 데이터를 표현할 수 있음
    - 로그에 timestamp를 무조건 남김
    - 스트림 데이터를 materiallized view형태로 봄
- ![람다 vs 카파](https://lh3.googleusercontent.com/-_K971FVqWANyfm2byWh1O8Nv4U6Wvxw1srIuQzJ7dgHgPdSDTknIj3Cj6sZ-h55osFbK6wB0YMelExJIqwH2R7Rfxb968HSxc-NaqLLIxcO-_s6UCtfwMJIlcg9C0U2gnIhBO1r)
- 배치 데이터 vs 스트림 데이터
  - bounded <-> unbounded
  - 대규모 분산 처리 <-> 지속적 분산 처리
  - 지연 발생 <-> 분 단위 이하 지연 발생
  - 복잡한 조인 수행 <-> 단순한 조인 수행
- 스트리밍 데이터 레이크
  - 배치레이어와 서빙레이어까지 제거
  - 대신 스피드레이어에 오랜기간 데이터를 저장하고 사용할 수 있어야 함 =>  tierd storage도입을 통해 해결하고자 함


## 퀴즈 O/X
- 1) 카프카는 메모리에 데이터를 저장하기 때문에 장애가 났을 경우 데이터가 유실 된다
  - X 파일시스템에 저장하게 되어 유실되지 않음
- 2) 카파 아키텍처는 람다 아키텍처를 개선한 데이터 아키텍처이다
  - O 람다에서 배치 레이어 제거
- 3) 서빙 레이어는 데이터를 프로세싱하는데 사용되는 곳이다
  - X 데이터를 활용하게 하기 위한 용도
